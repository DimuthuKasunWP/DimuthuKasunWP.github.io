<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Microservice Registration and Discovery with Spring Cloud and Netflix’s Eureka</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Microservice Registration and Discovery with Spring Cloud and Netflix’s Eureka</h1>
</header>
<section data-field="subtitle" class="p-summary">
Learn to create microservice, based on Spring cloud, on Netflix Eureka registry server and how other microservices (Eureka clients) use it…
</section>
<section data-field="body" class="e-content">
<section name="a290" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="eee5" id="eee5" class="graf graf--h3 graf--leading graf--title">Microservice Registration and Discovery with Spring Cloud and Netflix’s Eureka</h3><p name="0462" id="0462" class="graf graf--p graf-after--h3">Learn to create microservice, based on <a href="https://projects.spring.io/spring-cloud" data-href="https://projects.spring.io/spring-cloud" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Spring cloud</a>, on <a href="https://github.com/Netflix/eureka" data-href="https://github.com/Netflix/eureka" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Netflix Eureka</a> registry server and how other microservices (Eureka clients) use it to register and discover services to call their APIs.</p><p name="6b11" id="6b11" class="graf graf--p graf-after--p">We will be using Spring Boot based Spring Cloud API. We will use Netflix Eureka server for building the service registry server and Eureka clients which will register themselves and discover other services to call REST APIs.</p><h3 name="5433" id="5433" class="graf graf--h3 graf-after--p">Overview</h3><p name="5e1e" id="5e1e" class="graf graf--p graf-after--h3">We will create three microservices for this Netflix Eureka example.</p><ol class="postList"><li name="b493" id="b493" class="graf graf--li graf-after--p">Eureka Service Registry Server — This microservice will provide the service registry and discovery server.</li><li name="bd36" id="bd36" class="graf graf--li graf-after--li">Student Microservice — Which will give some functionality based on the Student entity. It will be a rest based service and most importantly it will be a eureka client service, which will talk with eureka service to register itself in the service registry.</li><li name="978c" id="978c" class="graf graf--li graf-after--li">School Microservice — Same type as of Student service — only added feature is that it will invoke Student service with <em class="markup--em markup--li-em">service lookup</em> mechanism. We will not use the absolute URL of student service to interact with that service.</li></ol><p name="45c2" id="45c2" class="graf graf--p graf-after--li">Here is the interaction diagram between above listed three services.</p><figure name="5bd2" id="5bd2" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 294px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 42%;"></div><img class="graf-image" data-image-id="0*UToVcanwinYVRs5-.jpg" data-width="743" data-height="312" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*UToVcanwinYVRs5-.jpg"></div></figure><h4 name="9b21" id="9b21" class="graf graf--h4 graf-after--figure">Tech Stack and Runtime</h4><ul class="postList"><li name="081d" id="081d" class="graf graf--li graf-after--h4">Java 1.8</li><li name="582e" id="582e" class="graf graf--li graf-after--li">Intellij Idea IDE</li><li name="4fce" id="4fce" class="graf graf--li graf-after--li">Spring cloud</li><li name="2274" id="2274" class="graf graf--li graf-after--li">Spring boot</li><li name="1f21" id="1f21" class="graf graf--li graf-after--li">Spring Rest</li><li name="dcc0" id="dcc0" class="graf graf--li graf-after--li">Maven</li></ul><h3 name="eab0" id="eab0" class="graf graf--h3 graf-after--li">What is Netflix Eureka Server and Clients?</h3><p name="6e17" id="6e17" class="graf graf--p graf-after--h3">As we know these days, there is a lot of momentum around Microservices. The transition from Monolithic to Microservice based architecture gives many benefits for future in terms of maintainability, scalability, high availability etc. However at the same time, there are many challenges also while doing this migration. One of them is to maintain individual Microservices addresses. This task can be hugely complex — depending on number of services and their dynamic nature. If whole infrastructure is distributed and there is some replication as well, then maintaining this service addresses becomes harder.</p><p name="1677" id="1677" class="graf graf--p graf-after--p">To solve this, in the distributed computing are there is a concept called ‘Service registration and discovery’ where one dedicated server is responsible to maintain the registry of all the Microservice that has been deployed and removed. This will act like a phone book of all other applications/microservices.</p><p name="91d8" id="91d8" class="graf graf--p graf-after--p">Think of it as a lookup service where microservices (clients) can register themselves and discover other registered microservices. When a client microservice registers with Eureka it provides metadata such as host, port, and health indicator thus allowing for other microservices to discover it. The discovery server expects a regular heartbeat message from each microservice instance. If an instance begins to consistently fail to send a heartbeat, the discovery server will remove the instance from his registry. This way we will have a very stable ecosystem of Microservices collaborating among each other, and on top of it we don’t have to manually maintain address of other Microservice, which is a next to impossible task if the scale up/down is very frequent, on demand and we use virtual host to host the services specially in the cloud environment.</p><h3 name="7cee" id="7cee" class="graf graf--h3 graf-after--p">Eureka Service Registry Server</h3><p name="ac24" id="ac24" class="graf graf--p graf-after--h3">Follow these steps to create and run Eureka server.</p><h4 name="2fa6" id="2fa6" class="graf graf--h4 graf-after--p">Create Eureka Server</h4><p name="a9a8" id="a9a8" class="graf graf--p graf-after--h4">Create a Spring boot project from <a href="https://start.spring.io/" data-href="https://start.spring.io/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Spring Boot initializer portal</a> with two dependencies i.e. <code class="markup--code markup--p-code">Eureka server</code> and <code class="markup--code markup--p-code">Actuator</code>. Give other maven GAV coordinates and download the project.</p><figure name="0ac4" id="0ac4" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 388px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 55.50000000000001%;"></div><img class="graf-image" data-image-id="0*qSdSzsceNzIPIcC9.jpg" data-width="1267" data-height="703" src="https://cdn-images-1.medium.com/max/800/0*qSdSzsceNzIPIcC9.jpg"></div></figure><p name="ee6f" id="ee6f" class="graf graf--p graf-after--figure">Unzip and import the project into Eclipse as existing maven project. In this step, all necessary dependencies will be downloaded from maven repository.</p><p name="fed7" id="fed7" class="graf graf--p graf-after--p">Now open <code class="markup--code markup--p-code">SpringEurekaServerApplication</code> class that spring already has generated in the downloaded project and add the <code class="markup--code markup--p-code"><a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/spring-cloud-netflix-eureka-server/src/main/java/org/springframework/cloud/netflix/eureka/server/EnableEurekaServer.java" data-href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/spring-cloud-netflix-eureka-server/src/main/java/org/springframework/cloud/netflix/eureka/server/EnableEurekaServer.java" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@EnableEurekaServer</a></code>annotation on the class.</p><pre name="d2b1" id="d2b1" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">package</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">com.example.howtodoinjava.springeurekaserver;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.boot.SpringApplication;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.boot.autoconfigure.SpringBootApplication;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code">org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</code></pre><pre name="b142" id="b142" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">@EnableEurekaServer<br>@SpringBootApplication<br><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">class</strong></code> <code class="markup--code markup--pre-code">SpringEurekaServerApplication {</code></pre><pre name="e52c" id="e52c" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">static</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">void</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">main(String[] args) {<br>SpringApplication.run(SpringEurekaServerApplication.<strong class="markup--strong markup--pre-strong">class</strong>, args);<br>}<br>}</code></pre><p name="6100" id="6100" class="graf graf--p graf-after--pre">Build the project once again. With this annotation, this artifact will act like microservice registry and discovery server.</p><h4 name="4d8e" id="4d8e" class="graf graf--h4 graf-after--p">Server Configuration</h4><p name="6081" id="6081" class="graf graf--p graf-after--h4">Create one file called <code class="markup--code markup--p-code">application.yml</code> in the <code class="markup--code markup--p-code">src\main\resources</code> directory. Add these properties –</p><pre name="e5ab" id="e5ab" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">server:<br>port: ${PORT:8761} # Indicate the <strong class="markup--strong markup--pre-strong">default</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">PORT where <strong class="markup--strong markup--pre-strong">this</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">service will be started<br>eureka:<br>client:<br>registerWithEureka: <strong class="markup--strong markup--pre-strong">false</strong></code>   <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">#telling the server not to register himself in the service registry<br>fetchRegistry: <strong class="markup--strong markup--pre-strong">false<br></strong>server:<br>waitTimeInMsWhenSyncEmpty: 0</code>    <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">#wait time <strong class="markup--strong markup--pre-strong">for</strong></code> <code class="markup--code markup--pre-code">subsequent sync</code></pre><p name="2bbd" id="2bbd" class="graf graf--p graf-after--pre">Create another file called <code class="markup--code markup--p-code">bootstrap.yml</code> in the <code class="markup--code markup--p-code">src\main\resources</code> directory. Add these properties –</p><pre name="f71c" id="f71c" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">spring:<br>application:<br>name: eureka<br>cloud:<br>config:<br>uri: ${CONFIG_SERVER_URL:http://localhost:8888}</code></pre><h4 name="3a38" id="3a38" class="graf graf--h4 graf-after--pre">Test Eureka Server</h4><p name="1a95" id="1a95" class="graf graf--p graf-after--h4">Start the application as spring boot application. Open browser and go to <code class="markup--code markup--p-code">http://localhost:8761/</code>, you should see the eureka server home page which looks like below.</p><figure name="fec9" id="fec9" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 364px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 52%;"></div><img class="graf-image" data-image-id="1*6I3IqI9fpt9Md_X6ZU-vAA.jpeg" data-width="1344" data-height="699" src="https://cdn-images-1.medium.com/max/800/1*6I3IqI9fpt9Md_X6ZU-vAA.jpeg"></div></figure><p name="f046" id="f046" class="graf graf--p graf-after--figure">Please note that at this point no service is registered here which is expected and once we will spin up the client services, this server will automatically updated with the details of the client services.</p><h3 name="52c4" id="52c4" class="graf graf--h3 graf-after--p">Eureka Client — Student Service</h3><p name="1805" id="1805" class="graf graf--p graf-after--h3">Follow these steps to create and run Eureka client running student service.</p><h4 name="4338" id="4338" class="graf graf--h4 graf-after--p">Create Eureka Client Project</h4><p name="df1b" id="df1b" class="graf graf--p graf-after--h4">Create a Spring boot project from initializer portal with four dependencies i.e. <code class="markup--code markup--p-code">Actuator</code>, <code class="markup--code markup--p-code">Web</code>, <code class="markup--code markup--p-code">Rest Repositories</code>, <code class="markup--code markup--p-code">Eureka Discovery</code>. Give other maven GAV coordinates and download the project.</p><figure name="63db" id="63db" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 357px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 51%;"></div><img class="graf-image" data-image-id="0*63sn5bOide9Xc7Tn.jpg" data-width="1357" data-height="692" src="https://cdn-images-1.medium.com/max/800/0*63sn5bOide9Xc7Tn.jpg"></div></figure><p name="5747" id="5747" class="graf graf--p graf-after--figure">Unzip and import the project into Eclipse as existing maven project.</p><p name="9a2e" id="9a2e" class="graf graf--p graf-after--p">Now add the <code class="markup--code markup--p-code"><a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/spring-cloud-netflix-eureka-client/src/main/java/org/springframework/cloud/netflix/eureka/EnableEurekaClient.java" data-href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/spring-cloud-netflix-eureka-client/src/main/java/org/springframework/cloud/netflix/eureka/EnableEurekaClient.java" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@EnableEurekaClient</a></code> annotation on Spring boot application class present in <code class="markup--code markup--p-code">src</code> folder. With this annotation, this artifact will act like a spring discovery client and will register itself in the eureka server attached to this service.</p><pre name="32e3" id="32e3" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">package</strong></code> <code class="markup--code markup--pre-code">com.example.howtodoinjava.springeurekaclientstudentservice;</code></pre><pre name="1efa" id="1efa" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.boot.SpringApplication;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.boot.autoconfigure.SpringBootApplication;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code">org.springframework.cloud.netflix.eureka.EnableEurekaClient;</code></pre><pre name="5caa" id="5caa" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">@SpringBootApplication<br>@EnableEurekaClient<br><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">class</strong></code> <code class="markup--code markup--pre-code">SpringEurekaClientStudentServiceApplication {</code></pre><pre name="cdb6" id="cdb6" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">static</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">void</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">main(String[] args) {<br>SpringApplication.run(SpringEurekaClientStudentServiceApplication.<strong class="markup--strong markup--pre-strong">class</strong>, args);<br>}</code></pre><pre name="b373" id="b373" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">}</code></pre><h4 name="feca" id="feca" class="graf graf--h4 graf-after--pre">Client Configuration</h4><p name="6adb" id="6adb" class="graf graf--p graf-after--h4">Create one file called <code class="markup--code markup--p-code">application.yml</code> in the <code class="markup--code markup--p-code">src\main\resources</code> directory and add below lines.</p><pre name="fb6f" id="fb6f" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">server:</code></pre><pre name="272f" id="272f" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">port: 8098</code>    <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">#<strong class="markup--strong markup--pre-strong">default</strong></code> <code class="markup--code markup--pre-code">port where the service will be started</code></pre><pre name="278e" id="278e" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">eureka:         #tells about the Eureka server details and its refresh time</code></pre><pre name="a2f8" id="a2f8" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">instance:</code></pre><pre name="e7b8" id="e7b8" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">leaseRenewalIntervalInSeconds: 1</code></pre><pre name="db33" id="db33" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">leaseExpirationDurationInSeconds: 2</code></pre><pre name="cb4a" id="cb4a" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">client:<br>serviceUrl:<br>defaultZone: http://127.0.0.1:8761/eureka/</code></pre><pre name="d8e7" id="d8e7" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">healthcheck:<br>enabled: <strong class="markup--strong markup--pre-strong">true</strong></code></pre><pre name="2d21" id="2d21" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">lease:<br>duration: 5</code></pre><pre name="0895" id="0895" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">spring:<br>application:<br>name: student-service   #current service name to be used by the eureka server</code></pre><pre name="8b8e" id="8b8e" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">management:<br>security:<br>enabled: <strong class="markup--strong markup--pre-strong">false</strong></code>  <code class="markup--code markup--pre-code">#disable the spring security on the management endpoints like /env, /refresh etc.</code></pre><pre name="35d7" id="35d7" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">logging:<br>level:<br>com.example.howtodoinjava: DEBUG</code></pre><h4 name="716e" id="716e" class="graf graf--h4 graf-after--pre">Add REST API</h4><p name="9567" id="9567" class="graf graf--p graf-after--h4">Now add one <code class="markup--code markup--p-code">RestController</code> and expose one rest endpoint for getting all the student details for a particular school. Here we are exposing <code class="markup--code markup--p-code">/getStudentDetailsForSchool/{schoolname}</code> endpoint to serve the business purpose. For simplicity, we are hard coding the student details.</p><pre name="4811" id="4811" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">package</strong></code> <code class="markup--code markup--pre-code">com.example.howtodoinjava.springeurekaclientstudentservice.controller;</code></pre><pre name="4c8f" id="4c8f" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">java.util.ArrayList;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">java.util.HashMap;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">java.util.List;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">java.util.Map;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.web.bind.annotation.PathVariable;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.web.bind.annotation.RequestMapping;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.web.bind.annotation.RequestMethod;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.web.bind.annotation.RestController;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code">com.example.howtodoinjava.springeurekaclientstudentservice.domain.Student;</code></pre><pre name="dee2" id="dee2" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">@RestController<br><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">class</strong></code> <code class="markup--code markup--pre-code">StudentServiceController {</code></pre><pre name="98ba" id="98ba" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">private</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">static</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">Map&lt;String, List&lt;Student&gt;&gt; schooDB = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code">HashMap&lt;String, List&lt;Student&gt;&gt;();</code></pre><pre name="84bb" id="84bb" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">static</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">{<br>schooDB = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">HashMap&lt;String, List&lt;Student&gt;&gt;();<br>List&lt;Student&gt; lst = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">ArrayList&lt;Student&gt;();<br>Student std = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">Student(&quot;Dimuthu&quot;, &quot;Class IV&quot;);<br>lst.add(std);<br>std = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">Student(&quot;Kasun&quot;, &quot;Class V&quot;);<br>lst.add(std);<br>schooDB.put(&quot;abcschool&quot;, lst);<br>lst = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">ArrayList&lt;Student&gt;();<br>std = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">Student(&quot;Pathirana&quot;, &quot;Class III&quot;);<br>lst.add(std);<br>std = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code">Student(&quot;Sandya&quot;, &quot;Class VI&quot;);<br>lst.add(std);<br>schooDB.put(&quot;xyzschool&quot;, lst);<br>}</code></pre><pre name="a96e" id="a96e" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">@RequestMapping(value = &quot;/getStudentDetailsForSchool/{schoolname}&quot;, method = RequestMethod.GET)<br><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code">List&lt;Student&gt; getStudents(@PathVariable</code> <code class="markup--code markup--pre-code">String schoolname) {<br>System.out.println(&quot;Getting Student details for &quot;</code> <code class="markup--code markup--pre-code">+ schoolname);<br>List&lt;Student&gt; studentList = schooDB.get(schoolname);</code></pre><pre name="5806" id="5806" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">if</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">(studentList == <strong class="markup--strong markup--pre-strong">null</strong>) {<br>studentList = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">ArrayList&lt;Student&gt;();<br>Student std = <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">Student(&quot;Not Found&quot;, &quot;N/A&quot;);<br>studentList.add(std);<br>}<br><strong class="markup--strong markup--pre-strong">return</strong></code> <code class="markup--code markup--pre-code">studentList;<br>}<br>}</code></pre><p name="f31a" id="f31a" class="graf graf--p graf-after--pre"><code class="markup--code markup--p-code">Student</code> class is a simple POJO.</p><pre name="dd4e" id="dd4e" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">class</strong></code> <code class="markup--code markup--pre-code">Student</code></pre><pre name="faf2" id="faf2" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">{<br><strong class="markup--strong markup--pre-strong">private</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">String name;<br><strong class="markup--strong markup--pre-strong">private</strong></code> <code class="markup--code markup--pre-code">String className;</code></pre><pre name="0e47" id="0e47" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">Student(String name, String className) {<br><strong class="markup--strong markup--pre-strong">super</strong>();<br><strong class="markup--strong markup--pre-strong">this</strong>.name = name;<br><strong class="markup--strong markup--pre-strong">this</strong>.className = className;</code></pre><pre name="6810" id="6810" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">}</code></pre><pre name="aac7" id="aac7" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">String getName() {<br><strong class="markup--strong markup--pre-strong">return</strong></code> <code class="markup--code markup--pre-code">name;<br>}</code></pre><pre name="23db" id="23db" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">void</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">setName(String name) {<br><strong class="markup--strong markup--pre-strong">this</strong>.name = name;<br>}</code></pre><pre name="66e5" id="66e5" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">String getClassName() {<br><strong class="markup--strong markup--pre-strong">return</strong></code> <code class="markup--code markup--pre-code">className;<br>}</code></pre><pre name="bf98" id="bf98" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong"><br>public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">void</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">setClassName(String className) {<br><strong class="markup--strong markup--pre-strong">this</strong>.className = className;<br>}</code></pre><pre name="4094" id="4094" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">}</code></pre><h4 name="0bf7" id="0bf7" class="graf graf--h4 graf-after--pre">Test Eureka Client</h4><p name="7390" id="7390" class="graf graf--p graf-after--h4">Start this project as spring boot application. Now verify that this service has been registered in Eureka server automatically. Go to Eureka service console and refresh the page. Now if everything goes well, we will see one entry for student-service in the eureka service console. This indicates that both Eureka server and client are aware each other.</p><figure name="7c97" id="7c97" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 369px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 52.7%;"></div><img class="graf-image" data-image-id="1*lmv05kZQxJwJ5OdjENYr3g.jpeg" data-width="1332" data-height="702" src="https://cdn-images-1.medium.com/max/800/1*lmv05kZQxJwJ5OdjENYr3g.jpeg"></div></figure><p name="ff0e" id="ff0e" class="graf graf--p graf-after--figure">We will now verify that the <code class="markup--code markup--p-code">/getStudentDetailsForSchool/{schoolname}</code> endpoint is up and running. Go to browser and go to <code class="markup--code markup--p-code">http://localhost:8098/getStudentDetailsForSchool/abcschool</code>, it will give the Student details for a particular school <code class="markup--code markup--p-code">abcschool</code>.</p><figure name="b850" id="b850" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 292px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 41.699999999999996%;"></div><img class="graf-image" data-image-id="1*5kree32iuGgow3LWKVWHqw.jpeg" data-width="1447" data-height="603" src="https://cdn-images-1.medium.com/max/800/1*5kree32iuGgow3LWKVWHqw.jpeg"></div></figure><h3 name="940d" id="940d" class="graf graf--h3 graf-after--figure">Eureka Client — School Service</h3><p name="9908" id="9908" class="graf graf--p graf-after--h3">Now we will create school service which will register itself with eureka server — and it will discover and invoke student-service without hardcoded URL path.</p><p name="a56f" id="a56f" class="graf graf--p graf-after--p">Follow exact steps for creating student service, to create and run Eureka client running school service as well.</p><h4 name="6cd0" id="6cd0" class="graf graf--h4 graf-after--p">Create Eureka Client Project</h4><p name="7975" id="7975" class="graf graf--p graf-after--h4">Create a Spring boot project from initializer portal with four dependencies i.e. <code class="markup--code markup--p-code">Actuator</code>, <code class="markup--code markup--p-code">Web</code>, <code class="markup--code markup--p-code">Rest Repositories</code>, <code class="markup--code markup--p-code">Eureka Discovery</code>. Give other maven GAV coordinates and download the project.</p><p name="4c72" id="4c72" class="graf graf--p graf-after--p">Unzip and import the project into Eclipse as existing maven project.</p><p name="411f" id="411f" class="graf graf--p graf-after--p">Now add the <code class="markup--code markup--p-code">@EnableEurekaClient</code> annotation on Spring boot application class present in <code class="markup--code markup--p-code">src</code> folder. With this annotation, this artifact will act like a spring discovery client and will register itself in the eureka server attached to this service.</p><pre name="4bcb" id="4bcb" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">package</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">com.example.howtodoinjava.springeurekaclientschoolservice;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.boot.SpringApplication;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.boot.autoconfigure.SpringBootApplication;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code">org.springframework.cloud.netflix.eureka.EnableEurekaClient;</code></pre><pre name="8136" id="8136" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">@SpringBootApplication<br>@EnableEurekaClient<br><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">class</strong></code> <code class="markup--code markup--pre-code">SpringEurekaClientSchoolServiceApplication {</code></pre><pre name="0d52" id="0d52" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">static</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">void</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">main(String[] args) {<br>SpringApplication.run(SpringEurekaClientSchoolServiceApplication.<strong class="markup--strong markup--pre-strong">class</strong>, args);<br>}<br>}</code></pre><h4 name="81ee" id="81ee" class="graf graf--h4 graf-after--pre">Client Configuration</h4><p name="cbee" id="cbee" class="graf graf--p graf-after--h4">Create one file called <code class="markup--code markup--p-code">application.yml</code> in the <code class="markup--code markup--p-code">src\main\resources</code> directory and add below lines. These configurations are very similar to student service <em class="markup--em markup--p-em">except port number and service name</em>.</p><pre name="7565" id="7565" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">server:<br>port: 9098</code>    <code class="markup--code markup--pre-code">#port number</code></pre><pre name="851a" id="851a" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">eureka:<br>instance:<br>leaseRenewalIntervalInSeconds: 1<br>leaseExpirationDurationInSeconds: 2</code></pre><pre name="3c55" id="3c55" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">client:<br>serviceUrl:<br>defaultZone: http://127.0.0.1:8761/eureka/</code></pre><pre name="8c18" id="8c18" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">healthcheck:<br>enabled: <strong class="markup--strong markup--pre-strong">true</strong></code></pre><pre name="fd27" id="fd27" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">lease:<br>duration: 5</code></pre><pre name="1795" id="1795" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">spring:<br>application:<br>name: school-service    #service name</code></pre><pre name="2aeb" id="2aeb" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">logging:<br>level:<br>com.example.howtodoinjava: DEBUG</code></pre><h4 name="936c" id="936c" class="graf graf--h4 graf-after--pre">Add REST API which consume student service’s REST API</h4><p name="9227" id="9227" class="graf graf--p graf-after--h4">Now add one <code class="markup--code markup--p-code">RestController</code> and expose one rest endpoint for getting school details. This endpoint will use the service discovery style URL using the application name, instead full URL with host:port.</p><pre name="c309" id="c309" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">package</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">com.example.howtodoinjava.springeurekaclientschoolservice.controller;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.beans.factory.annotation.Autowired;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.cloud.client.loadbalancer.LoadBalanced;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.context.annotation.Bean;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.core.ParameterizedTypeReference;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.http.HttpMethod;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.web.bind.annotation.PathVariable;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.web.bind.annotation.RequestMapping;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.web.bind.annotation.RequestMethod;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">org.springframework.web.bind.annotation.RestController;<br><strong class="markup--strong markup--pre-strong">import</strong></code> <code class="markup--code markup--pre-code">org.springframework.web.client.RestTemplate;</code></pre><pre name="fc7d" id="fc7d" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">@RestController<br><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">class</strong></code> <code class="markup--code markup--pre-code">SchoolServiceController {</code></pre><pre name="0338" id="0338" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">@Autowired<br>RestTemplate restTemplate;</code></pre><pre name="97db" id="97db" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">@RequestMapping(value = &quot;/getSchoolDetails/{schoolname}&quot;, method = RequestMethod.GET)<br><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code">String getStudents(@PathVariable</code> <code class="markup--code markup--pre-code">String schoolname)<br>{<br>System.out.println(&quot;Getting School details for &quot;</code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">+ schoolname);<br>String response = restTemplate.exchange(&quot;<a href="http://student-service/getStudentDetailsForSchool/" data-href="http://student-service/getStudentDetailsForSchool/" class="markup--anchor markup--pre-anchor" rel="noopener" target="_blank">http://student-service/getStudentDetailsForSchool/</a>{schoolname}&quot;,<br>HttpMethod.GET, <strong class="markup--strong markup--pre-strong">null</strong>, <strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code">ParameterizedTypeReference&lt;String&gt;() {}, schoolname).getBody();</code></pre><pre name="ede6" id="ede6" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">System.out.println(&quot;Response Received as &quot;</code> <code class="markup--code markup--pre-code">+ response);</code></pre><pre name="3dc2" id="3dc2" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">return</strong></code> <code class="markup--code markup--pre-code">&quot;School Name -  &quot;</code> <code class="markup--code markup--pre-code">+ schoolname + &quot; \n Student Details &quot;</code> <code class="markup--code markup--pre-code">+ response;</code></pre><pre name="c0dc" id="c0dc" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">}</code></pre><pre name="bf91" id="bf91" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">@Bean<br>@LoadBalanced<br><strong class="markup--strong markup--pre-strong">public</strong></code> <code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">RestTemplate restTemplate() {<br><strong class="markup--strong markup--pre-strong">return</strong></code> <code class="markup--code markup--pre-code"><strong class="markup--strong markup--pre-strong">new</strong></code> <code class="markup--code markup--pre-code">RestTemplate();<br>}</code></pre><pre name="60fe" id="60fe" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">}</code></pre><p name="e667" id="e667" class="graf graf--p graf-after--pre">This way we can get rid of specific service configuration and we can give the service look up responsibility to eureka server and rest template provided here. We can also apply load balancing (see <code class="markup--code markup--p-code">@LoadBalanced</code> annotation) here if the multiple instances are running for the same service.</p><p name="5d81" id="5d81" class="graf graf--p graf-after--p">The URL we have used is <code class="markup--code markup--p-code">http://student-service/getStudentDetailsForSchool/{schoolname}</code>. Clearly we are using only service name <code class="markup--code markup--p-code">student-service</code> in the place of <code class="markup--code markup--p-code">host:port</code>. This will be handled internally by spring framework, eureka server and rest template together.</p><h3 name="f241" id="f241" class="graf graf--h3 graf-after--p">Demo of Service Discovery and Calling</h3><p name="078d" id="078d" class="graf graf--p graf-after--h3">Now start the school service as well. All three services are started. Check the eureka server console. Bothe student and school services must be registered there.</p><figure name="4a84" id="4a84" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 362px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 51.6%;"></div><img class="graf-image" data-image-id="1*jkt1_kFAipo30dLCRlGqNQ.jpeg" data-width="1336" data-height="690" src="https://cdn-images-1.medium.com/max/800/1*jkt1_kFAipo30dLCRlGqNQ.jpeg"></div></figure><p name="c7c4" id="c7c4" class="graf graf--p graf-after--figure">Go to browser and go to <a href="http://localhost:9098//getSchoolDetails/abcschool," data-href="http://localhost:9098//getSchoolDetails/abcschool," class="markup--anchor markup--p-anchor" target="_blank">http://localhost:9098//getSchoolDetails/abcschool,</a> it will give the school details for a particular school <em class="markup--em markup--p-em">abcschool</em> details. We have invoked student service internally. The response will look like in the browser:</p><figure name="b09d" id="b09d" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 23.9%;"></div><img class="graf-image" data-image-id="1*Ui6riLT_U4gqyN5X2jngmA.jpeg" data-width="1634" data-height="391" src="https://cdn-images-1.medium.com/max/800/1*Ui6riLT_U4gqyN5X2jngmA.jpeg"></div></figure><h3 name="4864" id="4864" class="graf graf--h3 graf-after--figure">Things to check if facing any error</h3><ol class="postList"><li name="bb09" id="bb09" class="graf graf--li graf-after--h3">Annotations <code class="markup--code markup--li-code">@EnableEurekaServer</code> and <code class="markup--code markup--li-code">@EnableEurekaClient</code> are the heart of the application ecosystem. Without those two things will not work at all.</li><li name="1d02" id="1d02" class="graf graf--li graf-after--li">Make sure at the time of starting the config client service, eureka server service is running already, otherwise it might take some time to register, which might create confusion while testing.</li></ol><h3 name="4d9c" id="4d9c" class="graf graf--h3 graf-after--li">Summary</h3><p name="4e20" id="4e20" class="graf graf--p graf-after--h3">We saw how easily one can deploy service registry and discovery server as well as clients efficiently. Spring framework is maintaining lots of things internally. Here we are just using couple of annotations and very minimal configuration to achieve the whole things quickly.</p><p name="46ca" id="46ca" class="graf graf--p graf-after--p">That’s all about creating spring could eureka server and service registration for microservices. Please add comments if you have any difficulty executing this article. We will be happy to look into the problem.</p><p name="d82f" id="d82f" class="graf graf--p graf-after--p">Check Source Code <a href="https://github.com/DimuthuKasunWP/Spring-Cloud-Service-Discovery-with-Netflix-Eureka" data-href="https://github.com/DimuthuKasunWP/Spring-Cloud-Service-Discovery-with-Netflix-Eureka" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Here</a></p><p name="a573" id="a573" class="graf graf--p graf-after--p graf--trailing">Happy Learning !!</p></div></div></section>
</section>
</article></body></html>